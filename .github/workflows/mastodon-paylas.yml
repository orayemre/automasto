
name: Mastodon Otomatik Paylaşım

on:
  schedule:
    - cron: '0 8 * * *' # Her gün saat 08:00'de çalışır (UTC)

jobs:
  paylas:
    runs-on: ubuntu-latest
    steps:
      - name: Gist'i İndir
        uses: actions/checkout@v2
        with:
          repository: 'orayemre/fa7b2f4758251a7901a64d3715b171d7' # Gist URL'sindeki ID'yi buraya yazın

      - name: Node.js Kur
        uses: actions/setup-node@v2
        with:
          node-version: '16' # Veya daha güncel bir sürüm

      - name: Paketleri Kur
        run: npm install mastodon-api

      - name: Paylaşımı Yap
        run: |
          # Gist'deki hikayeler.js dosyasını import et
          const hikayeler = require('./hikayeler.js');

          const Mastodon = require('mastodon-api');
          const mastodon = new Mastodon({
            access_token: process.env.MASTODON_TOKEN,
            api_url: 'https://sosyal.teknofest.app/api/v1/' // Kendi Mastodon sunucu adresiniz
          });

          // Rastgele 5 hikaye seç
          const secilenHikayeler = hikayeler.sort(() => 0.5 - Math.random()).slice(0, 5);

          // Her bir hikayeyi paylaş
          secilenHikayeler.forEach(hikaye => {
            mastodon.post('statuses', { status: hikaye })
              .then(resp => {
                console.log(`Başarıyla paylaşıldı: ${resp.data.url}`);
              })
              .catch(err => {
                console.error('Hata oluştu:', err);
              });
          });
        env:
          MASTODON_TOKEN: ${{ secrets.MASTODON_TOKEN }}
